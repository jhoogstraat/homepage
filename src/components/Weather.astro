---
// Weather widget - shows weather at the developer's location
// Uses Open-Meteo API (free, no auth required) or custom endpoint
---

<div id="weather" class="border border-border rounded-lg p-3 h-fit">
  <div class="flex items-center gap-3">
    <div id="weather-icon" class="text-3xl">
      â˜€ï¸
    </div>
    <div class="flex-1">
      <div class="flex items-baseline gap-2">
        <span id="weather-temp" class="text-xl font-semibold">â€”Â°</span>
        <span id="weather-condition" class="text-sm opacity-70">Loading...</span>
      </div>
      <div id="weather-location" class="text-xs opacity-50">ğŸ“ At my desk</div>
    </div>
    <div class="text-right text-xs opacity-50">
      <div id="weather-humidity">Humidity: â€”%</div>
      <div id="weather-wind">Wind: â€” km/h</div>
    </div>
  </div>
</div>

<script>
  // Weather codes to icons/conditions
  const weatherCodes: Record<number, { icon: string; condition: string }> = {
    0: { icon: 'â˜€ï¸', condition: 'Clear sky' },
    1: { icon: 'ğŸŒ¤ï¸', condition: 'Mainly clear' },
    2: { icon: 'â›…', condition: 'Partly cloudy' },
    3: { icon: 'â˜ï¸', condition: 'Overcast' },
    45: { icon: 'ğŸŒ«ï¸', condition: 'Foggy' },
    48: { icon: 'ğŸŒ«ï¸', condition: 'Depositing rime fog' },
    51: { icon: 'ğŸŒ§ï¸', condition: 'Light drizzle' },
    53: { icon: 'ğŸŒ§ï¸', condition: 'Moderate drizzle' },
    55: { icon: 'ğŸŒ§ï¸', condition: 'Dense drizzle' },
    61: { icon: 'ğŸŒ§ï¸', condition: 'Slight rain' },
    63: { icon: 'ğŸŒ§ï¸', condition: 'Moderate rain' },
    65: { icon: 'ğŸŒ§ï¸', condition: 'Heavy rain' },
    71: { icon: 'ğŸŒ¨ï¸', condition: 'Slight snow' },
    73: { icon: 'ğŸŒ¨ï¸', condition: 'Moderate snow' },
    75: { icon: 'ğŸŒ¨ï¸', condition: 'Heavy snow' },
    95: { icon: 'â›ˆï¸', condition: 'Thunderstorm' },
  };

  async function fetchWeather() {
    try {
      // Using Open-Meteo API - free, no auth
      // Replace with your actual coordinates
      const lat = 52.52; // Example: Berlin
      const lon = 13.41;
      
      const response = await fetch(
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&temperature_unit=celsius`
      );
      const data = await response.json();
      
      const current = data.current;
      const weather = weatherCodes[current.weather_code] || { icon: 'ğŸŒ¡ï¸', condition: 'Unknown' };
      
      document.getElementById('weather-icon')!.textContent = weather.icon;
      document.getElementById('weather-temp')!.textContent = `${Math.round(current.temperature_2m)}Â°`;
      document.getElementById('weather-condition')!.textContent = weather.condition;
      document.getElementById('weather-humidity')!.textContent = `Humidity: ${current.relative_humidity_2m}%`;
      document.getElementById('weather-wind')!.textContent = `Wind: ${Math.round(current.wind_speed_10m)} km/h`;
    } catch {
      // Fallback if API fails
      document.getElementById('weather-icon')!.textContent = 'ğŸŒ¤ï¸';
      document.getElementById('weather-temp')!.textContent = '22Â°';
      document.getElementById('weather-condition')!.textContent = 'Partly cloudy';
      document.getElementById('weather-humidity')!.textContent = 'Humidity: 45%';
      document.getElementById('weather-wind')!.textContent = 'Wind: 12 km/h';
    }
  }

  fetchWeather();
  // Update every 30 minutes
  setInterval(fetchWeather, 1800000);
</script>
